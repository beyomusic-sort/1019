<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>BEYOOOOONDS楽曲ソート</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --accent: #007aff;
      --bg: #f4f4f8;
      --card-radius: 18px;
      --shadow-soft: 0 5px 20px rgba(0,0,0,0.05);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: var(--bg);
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 560px;
      padding: 16px;
      margin: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .card {
      background: #fff;
      border-radius: var(--card-radius);
      box-shadow: var(--shadow-soft);
      padding: 22px 18px;
    }

    h1 {
      font-size: 1.55rem;
      margin: 4px 0 10px;
      text-align: center;
      white-space: nowrap;
    }

    .sub { text-align:center; font-size: .9rem; margin-top:4px; }
    .note { text-align:center; font-size:.7rem; margin-top:10px; opacity:.9; }

    .mode-buttons {
      display:flex; flex-direction:column;
      gap:10px; margin-top:18px;
      align-items:center;
    }

    .btn {
      width:100%; max-width:360px;
      padding:12px 18px;
      border-radius:999px;
      border:1.5px solid var(--accent);
      background:#fff;
      font-size:.95rem;
      cursor:pointer;
      color: var(--accent);
      transition:.2s;
    }
    .btn:hover { background:#eaf3ff; }

    .pair-container {
      display:flex; flex-direction:column; gap:12px; margin-top:14px;
    }

    .option {
      background:#fafafa; padding:14px;
      border-radius:14px; border:1px solid #ddd;
      cursor:pointer; transition:.2s;
      text-align:center;
    }
    .option:hover { background:#fff; box-shadow:0 3px 10px rgba(0,0,0,.06); }

    .status { text-align:center; font-size:.85rem; margin-top:4px; }
    .progress-bar { width:100%; height:8px; background:#ddd; border-radius:10px; margin:10px 0; }
    .progress-inner { width:0; height:100%; background:var(--accent); transition:.25s; }

    .results-list li {
      padding:6px 0;
      border-bottom:1px solid #eee;
      font-size:.92rem;
      line-height:1.45;
      display:flex;
      gap:6px;
    }

    .result-actions {
      display:flex;
      justify-content:flex-end; /* ★右寄せ */
      gap:8px;
      margin:20px 0 18px;
    }

    .mini-btn {
      padding:8px 12px;
      font-size:.8rem;
      width:auto;
      background:#fff;
      border:1.5px solid var(--accent);
      border-radius:8px;
      color:var(--accent);
      cursor:pointer;
    }

    .creator { text-align:center; margin-top:12px; font-size:.8rem; }
    .creator a { color:var(--accent); text-decoration:none; }
  </style>
</head>

<body>
<div class="app">

<!-- ▼ TOP PAGE -->
<div class="card" id="startCard">
  <h1>BEYOOOOONDS楽曲ソート</h1>
  <p class="sub">モードを選択してください</p>

  <div class="mode-buttons">
    <button class="btn" onclick="start(false)">BEYOOOOONDS楽曲ソート</button>

    <button class="btn" onclick="start(true)">
      BEYOOOOONDS楽曲ソート<br>（演劇女子部含む）
    </button>
  </div>

  <p class="note">
    音源リリース済みでメンバーが歌唱した楽曲のみ。<br>
    アルバム収録の寸劇・歌唱無しのトラックなどは入っておりません。
  </p>

  <div class="creator">製作者 <a href="https://x.com/beyomusicsort">@beyomusicsort</a></div>
</div>


<!-- ▼ SORT -->
<div class="card" id="compareCard" style="display:none;">
  <h1 id="modeTitle"></h1>
  <p class="sub">好きな曲を選んでください</p>

  <div class="status" id="statusText">0% 完了</div>
  <div class="progress-bar"><div id="progressInner" class="progress-inner"></div></div>

  <div class="pair-container">
    <div class="option" id="leftOption"></div>
    <div class="option" id="rightOption"></div>
  </div>

  <div style="display:flex; flex-direction:column; align-items:center; gap:10px; margin-top:12px;">
    <button class="btn" onclick="tie()">引き分け</button>
    <button class="btn" onclick="goBack()" id="backBtn" disabled>ひとつ戻る</button>
  </div>

  <div class="creator"><a href="#" onclick="resetAll()">トップへ戻る</a></div>
</div>


<!-- ▼ RESULT -->
<div class="card" id="resultCard" style="display:none;">
  <h1>結果</h1>

  <ol class="results-list" id="resultsList"></ol>

  <div class="result-actions">
    <button class="mini-btn" id="saveBtn">保存</button>
    <button class="mini-btn" id="shareBtn">共有</button>
  </div>

  <div class="creator"><a href="#" onclick="resetAll()">トップへ戻る</a></div>
</div>


</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
/* ------------------------ 設定 ------------------------ */
const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbxVu5Y0TDyzDl3kRP_s1v9qt4N0xzkc-iXgb9s7XgB4HxU8wyRMDvqOKj5OcAE5FJfEWA/exec";

/* --- 曲データ（修正反映済） --- */
let songs = [
  "眼鏡の男の子(1stシングル)",
  "Go Waist (1stシングル)",
  "ニッポンノD・N・A！ (1stシングル)",
  "文化祭実行委長の恋(1stシングル)",
  "ビタミンME(2ndシングル)",
  "信じるもの〜ホントのわたし(演劇女子部「不思議の国のアリスたち」)",
  "最KOO DE DANCE(コラボレーションシングル)"
  //（本番用はここに全部入ってる）
];

/* ------------------- 変数 ------------------- */
let pool = [];
let ranked = [];
let idx = 0;
let history = [];
let stageMode = false;

/* ------------------- 関数 ------------------- */

function resetAll(){
  document.getElementById("startCard").style.display = "block";
  document.getElementById("compareCard").style.display = "none";
  document.getElementById("resultCard").style.display = "none";
}

function start(stage){
  stageMode = stage;

  pool = songs.filter(s => stage || !s.includes("演劇女子部"))
              .sort(() => Math.random() - 0.5);

  ranked = [];
  idx = 0;
  history = [];

  document.getElementById("startCard").style.display = "none";
  document.getElementById("compareCard").style.display = "block";

  ranked.push(pool[idx++]);
  next();
}

function compare(leftBetter){
  history.push(JSON.stringify({ pool, ranked, idx }));
  let insertIndex = leftBetter ? ranked.length : 0;
  ranked.splice(insertIndex,0,pool[idx]);
  idx++;
  next();
}

function tie(){
  history.push(JSON.stringify({ pool, ranked, idx }));
  ranked.push(pool[idx]);
  idx++;
  next();
}

function goBack(){
  if(!history.length) return;
  let s = JSON.parse(history.pop());
  pool=s.pool; ranked=s.ranked; idx=s.idx;
  updateUI();
}

function next(){
  if(idx >= pool.length) return finish();
  updateUI();
}

function updateUI(){
  let percent = Math.floor((idx/pool.length)*100);
  document.getElementById("statusText").innerText = `${percent}% 完了`;
  document.getElementById("progressInner").style.width = percent + "%";

  document.getElementById("leftOption").innerText = pool[idx];
  document.getElementById("rightOption").innerText = ranked[Math.floor(ranked.length/2)];

  document.getElementById("backBtn").disabled = history.length===0;
}

function finish(){
  document.getElementById("compareCard").style.display = "none";
  document.getElementById("resultCard").style.display = "block";

  let list=document.getElementById("resultsList");
  list.innerHTML="";

  ranked.forEach((s,i)=>{
    list.innerHTML+=`<li>${i+1}. ${s}</li>`;
  });

  sendResult();
}

function sendResult(){
  fetch(ENDPOINT_URL,{
    method:"POST",
    mode:"no-cors",
    body:JSON.stringify({
      ranked,
      mode:stageMode?"stage":"normal",
      ua:navigator.userAgent
    })
  });
}

/* 保存 */
document.getElementById("saveBtn").onclick=()=>{
  html2canvas(document.getElementById("resultCard")).then(canvas=>{
    const a=document.createElement("a");
    a.href=canvas.toDataURL();
    a.download="BEYOOOOONDS_sort_result.png";
    a.click();
  });
};

/* 共有 */
document.getElementById("shareBtn").onclick=()=>{
  let text = `BEYOOOOONDS楽曲ソート 結果\n\n`;
  ranked.slice(0,5).forEach((s,i)=>{
    text += `${i+1}. ${s}\n`;
  });
  text += `\n#ビヨ曲ソート\n${location.href}`;
  window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`);
};
</script>
</body>
</html>
